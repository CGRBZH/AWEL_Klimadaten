---
title: "Project management structures, planning, and workflows"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    fig_width: 9
    fig_height: 6
    fig_caption: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# install.packages("DiagrammeR")
library("DiagrammeR")

```

# Projektbeschrieb

## Datengrundlage

### Open Government Data

The AWEL's air department publishes daily updated data on the city climate in selected areas of the canton of Zurich as open government data on opendata.swiss.

**OGD dataset:** contains air temperature and relative humidity (since 05/2019, 10 minute averages, automatically updated at fixed intervals (currently weekly, but can be increased)), including location name and x/y/z coordinates assigned to each measured value: https://opendata.swiss/de/dataset/lufttemperatur-und-luftfeuchte-lora-sensor-messwerte

A [data description with notes on data handling & data structure](http://www.web.statistik.zh.ch/awel/LoRa/data/datenbeschrieb.txt) is available as a supplement.

**Data update:** Every first Monday of a month a new monthly file is written to the FTP server of the Statistical Office of the Canton of Zurich. Example for July 2020: http://www.web.statistik.zh.ch/awel/LoRa/data/AWEL_Sensors_LoRa_202007.csv (Note: In the file name, the suffix with the month number and, at the turn of the year, also the year number '_2020XX.csv' changes).

### Metadata

For the OGD dataset there is a metadata file (*.txt) with operating periods per sensor / location, coordinates, location classification etc. It is stored on the ftp server of STAT:

- Logbook: http://www.web.statistik.zh.ch/awel/LoRa/metadata/AWEL_LoRa_Logbuch.csv

- Calibrating sensors: http://www.web.statistik.zh.ch/awel/LoRa/metadata/AWEL_LoRa_Kalibration_Sensoren.csv

### rOstluft AWS interface

The rOstluft AWS interface contains among other things the temperature data of MeteoSchweiz, updated daily. Available via rOstluft AWS data store using the R interface as described in '[Initialise_rOstluft_DataStore.R](http://10.73.108.152:8788/STAT/AWEL_Interaktive_Stadtklima_Auswertungen/src/branch/master/R/Initialise_rOstluft_DataStore.R)'.

**Data protection:** Data only for internal use, aggregated data may be published by us with reference to data source

**Access data:** All access data for the user Statistikamt_Kanton_Zuerich is held by Corinna Grobe.

**Initialization:** See [rOstluft Tutorial on GitHub](https://ostluft.github.io/rOstluft/articles/articles/tutorial.html)

### Publications on ZHweb

•	[ZHweb Stadtklima](https://www.zh.ch/de/umwelt-tiere/klima/stadtklima.html)

•	[Messbericht Sommer 2019 mit ein paar Auswertebeispielen als pdf](https://www.zh.ch/content/dam/zhweb/bilder-dokumente/themen/umwelt-tiere/klima/stadtklima/Stadtklima_Messnetz_Messbericht_2019.pdf)


## Projektziel

Automatisierte Darstellungen von Messwerten und ausgesuchten Auswertungen zum Stadtklima im ZHweb in Form interaktiver Grafiken & Tabellen. 

**Automatisch:** Darstellungen und Auswertungen werden in definierten Intervallen nachgeführt und mit aktualisierten Messdaten aufdatiert.

**Interaktiv:** Benutzer können (ausgehend von Voreinstellungen) bestimmte Elemente der Anzeige selber auswählen (z.B. bestimmte Zeitperioden, Standorte, Standortkombinationen wie ausgewählte Wärmeinseln, bestimmte Metriken etc). 

**Zielpublikum:** Fachleute (inkl. uns selber, um mit ausgesuchten Grafiken zeitnah bei Hitzewellen zu kommunizieren) & interessierte Laien und Journalisten.

**Zeitrahmen:** Als Zeitrahmen wurde sich auf einen ersten schriftlichen Input durch das AWEL bis Ende September geeinigt, das Statistikamt kann mit ersten Arbeiten im Herbst 2020 beginnen. Ziel ist, Visualisierungen im Mai 2021 operativ zu haben. Das weitere Vorgehen in dieser Sache, wie regelmässiger Austausch, gegenseitige fachliche Unterstützung, konkrete Milestones etc ist allerdings noch gemeinsam festzulegen.


## Definitionen

**Hitzetag:**

Kalendertag an dem maximale, 10-Minuten-gemittelte Temperatur > 30°C; kann pro Standort definiert werden (z.B. um Varianz zwischen Standorten zu zeigen) oder für Grossregion (z.B. Definition gemäss MeteoSchweiz: ausgewählte Messstationen des [Klimamessnetzes](https://www.meteoschweiz.admin.ch/home/mess-und-prognosesysteme/bodenstationen/schweizer-klimamessnetz.html) => [Klimaindikatoren](https://www.meteoschweiz.admin.ch/home/klima/schweizer-klima-im-detail/klima-indikatoren.html); für Kanton Zürich steht hier die MeteoSchweiz-Station Zürich/Fluntern (SMA) => kann für allgemenein Hitzetag-Zeitstrahl herangezogen werden; Daten verfügbar via rOstluft AWS server); Im Stadtklima-Messnetz Metedatensatz (ftp Server Statistikamt) wird die ländliche Referenzstation eines jeden Standortes definiert.

**Tropennacht:**

Kalendertag an dem minimale, 10-Minuten-gemittelte Temperatur > 20°C; Erläuterungen gleich wie oben für Hitzetage.

**Wärmeinsel:**
Temperaturerhöhung eines zusammenhängend besiedelten Gebietes gegenüber dem entsprechenden Umland (typischerweise ausgedrückt als Temperaturdifferenz zu einer Referenzstation im Umland). Ist am ausgeprägtesten in der Nacht bzw. den frühen Morgenstunden, d.h. der maximale Wärmeinseleffekt pro Nacht respektive Nacht tritt nachts bei wenig Wind und heissen Tagen auf; in solchen Situationen sind auch die Gesundheitswirkungen von Hitze bei empfindlichen Personen am stärksten. Entsprechend der Definition hat jede grössere Siedlung eine eigene Wärmeinsel, z.B. die Städte Zürich, Winterthur, Bülach, Uster, etc.


## Module für Darstellungen

**Geographischer Raum:** Das zusammenhängend besiedelte Gebiet und nicht die Gemeindegrenzen. Im Stadtklima-Messnetz Metedatensatz wird die Zugehörigkeit eines jeden Standortes zu seiner entsprechenden Wärmeinsel definiert.

### 1. Übersichts-Zeitstrahl Hitzetage

- Zeitstrahl mit Hitzetag ja/nein für den MeteoSchweiz Klimamessnetz-Standort Zürich/Fluntern (SMA), welcher als repräsentativ für die allg. Situation im Kanton genommen wird und mit der MeteoSchweiz Kommunikation kompatibel ist. 

-	Zeiträume können interaktiv via Zeitstrahl ausgewählt werden; automatisch markiert & angewählt: letzte Hitzeperiode (=> Metriken zu Wärmeinseln, siehe 3), würden sich dann automatisch auf die im Zeitstrahl angewählten Zeiträume beziehen). Offen: wie Zeitstrahl strukturieren? Linear panbar / Kalenderform / Wochen / Monate / Sommerhalbjahr (z.B. MeteoSchweiz)?

### 2. Interaktive Karte mit Standorten inkl. Daten
-	Karte über alle Sensorstandorte; zoom- und pan-bar

- Standorte als Kreise (Achtung: Standortverteilung hat einen Zeitstand! => z.B. Standorte in über Zeitstrahl 1) ausgewählter Periode darstellen)

- Farbe der Kreisfüllung zeigt interaktiv ausgewählte Metrik (z.B. max. Tagestemperatur, min. Tagestemperatur, über längere Periode via Zeitstrahl Anzahl Hitzetage, Anzahl Tropennächte etc) 

- Bei click auf einzelnen Punkt: Popup oder in separater Grafik unter 4) mit Zeitverlauf von Temperatur; mehrere Punkte selektierbar => mehrere Zeitverläufe in einer Verlaufsgrafik (auch als eine Grundlage für 4))

### 3. Darstellung von Metriken zu ausgewählten Wärmeinseln (z.B. Zürich, Winterthur, etc) oder Einzelstandorten

- Metriken, pro Jahr / ausgewählter Hitzeperiode gemäss Zeitstrahl 1) und ausgewählten Wärmeinseln (Zuordnung Standort – Wärmeinsel in Metadatensatz auf ftp Server): Anzahl Tropennächte, Anzahl Hitzetage, Minimumtemperatur, Maximumtemperatur, maximaler Temperaturunterschied pro Standort zu ländlicher Referenz (ebenfalls in Metadatensatz referenziert) 

- Verteilung / Statistiken der Metriken pro Wärmeinsel und Standortkategorie (z.B. Stadt, Stadt/Grünfläche, Stadtrand, Land) 

### 4. Gegenüberstellung von ausgewählten Fallbeispielen (d.h. Vergleich von Einzelstandorten)

- Interaktiv ausgewählte Standorte mit Temperatur-Zeitverläufen einander gegenüberstellen / vergleichen (Zeitperiode via 1) Zeitstrahl)

- Auch Presets an Standortvergleichen wählbar (noch zu definieren => z.B. Stadt/Grünfläche vs. Stadt/versiegelt: Bertastrasse vs. Friedhof Sihlfeld, usw)

- Vergleich von standortbezogenen Metriken (Anzahl Tropennächte etc), z.B. Stadt/Grünfläche vs. Stadt/versiegelt: Bertastrasse vs. Friedhof Sihlfeld, usw

### 5. Tabelle Metriken Einzelstandorte (z.B. über jüngsten 7 Tage)

- Standortbezogene Metriken über definierten Zeitraum als Tabelle: Anzahl Tropennächte, Anzahl Hitzetage, Minimumtemperatur, Maximumtemperatur der letzten 7 Tage oder über den frei wählbaren Zeitraum in Zeitstrahl 1)

## Mindestens notwendige Auswertschritte

- Zusammenführen von OGD Daten und zusätzlichen Messdaten der MeteoSchweiz (MeteoSchweiz Daten via AWS rOstluft S3 Server vorstrukturiert verfügbar mit R-Schnittstelle und R-Methoden => Zugangsdaten AWS rOstluft für Statistikamt wird vorbereitet. Datennutzungsbedingungen MeteoSchweiz beachten! => sollte für aggregierte, weiterverarbeitete Daten kein Problem sein)

- Zuweisung zusätzliche Metadaten (Standortklasse, Wärmeinsel, Referenzstation) pro Standort zu Messdaten

- Berechnung Metriken (Tropennächte, Hitzetage, Temperaturunterschied vs Referenz, etc) pro Standort sowie pro Wärmeinsel (in letzterem Fall: wie über alle Standorte / Standortklassen einer Wärmeinsel darstellen?: Mittelwerte, Perzentile, Boxplots, Bereiche etc?)

- Metriken nur für Standorte berücksichtigen, die ausreichende Datenabdeckung (z.B. xx% gültige Messwerte pro Tag/Woche) während der Sommermonate beinhalten (d.h. untereinander vergleichbar sind)

- Die Berechnungen sind rechenintensiv => Auswertung Metriken inkrementell aufdatieren? 


# Project planning

In this section we plan the steps needed to complete the task as efficiently as possible: “smart preparation minimizes work”.

## Workflow

‘workflow’ as the sum of practices, habits and systems that enable productivity.

### Tips for efficient workflow

- Start without writing code but with a clear mind and perhaps a pen and paper. This will ensure you keep your objectives at the forefront of your mind, without getting lost in the technology.

 - Make a plan. The size and nature will depend on the project but timelines, resources and ‘chunking’ the work will make you more effective when you start.

- Select the packages you will use for implementing the plan early. Minutes spent researching and selecting from the available options could save hours in the future.

- Document your work at every stage; work can only be effective if it’s communicated clearly and code can only be efficiently understood if it’s commented.

- Make your entire workflow as reproducible as possible. knitr can help with this in the phase of documentation.


Strategic thinking is especially important during a project’s inception; if you make a bad decision early on, it will have cascading negative impacts throughout the project’s entire lifespan (Gillespie and Lovelace [2020](https://csgillespie.github.io/efficientR/)). 

To minimise *technical debt* (“not quite right code which we postpone making it right” (Kruchten, Nord, and Ozkaya 2012)) at the outset, the best place to start may be with a pen and paper and an open mind. Sketching out your ideas and deciding precisely what you want to do, free from the constraints of a particular piece of technology, can be a rewarding exercise before you begin. Project planning and ‘visioning’ can be a creative process not always well-suited to the linear logic of computing.

![Schematic illustration of key project phases and levels of activity over time.](`r "C:/gitrepos/AWEL_Interaktive_Stadtklima_Auswertungen/graphics/figure_html/Schema_Project_Phases.png"`)

The tasks that a project should be split into will depend on the nature of the work and the phases illustrated in above represent a rough starting point, not a template, and the ‘programming’ phase will usually need to be split into at least ‘data tidying’, ‘processing’, and ‘visualisation’.

[DiagrammeR](http://rich-iannone.github.io/DiagrammeR/), a new package for creating network graphs and other schematic diagrams in R. This package provides an R interface to simple flow-chart file formats such as [mermaid](https://mermaid-js.github.io/mermaid/#/gantt).

```{r echo=FALSE}

# Define the Gantt chart and plot the result
mermaid("gantt
  dateFormat  YYYY-MM-DD
  title Interaktive Stadtklima Auswertungen
  
  section Versions
  Beta Version :active,    v1, 2020-12-06,2021-02-28
  Productive Version :     v2, after v1, 2021-05-01 
  
  section Planning
  Planning    :active,  plan1, 2020-12-06, 10d
  Parallel 1   :         plan11, with plan1, 2d
  Parallel 2   :         plan12, after plan11, 3d
  Parallel 3   :         plan13, after plan12, 4d
  Package Selection   :         plan14, after plan13, 1d
  
  section Documentation
  Project documentation in Gitea: active, doc1, 2020-12-06, 2021-05-01
  Project set-up:done, doc2, with doc1, 1d
  
  section Programming
  Programming :active,    prog1, 2020-12-06,2021-02-28
  ")


```


## Package selection

## Publication

This final stage is relevant as we want our code to be useful for others in the long term. To this end, this Section touches on documentation using knitr and the much stricter approach to coding for publication and package development. Making documentation integral to your overall workflow will make this stage much easier and more efficient.

# References
Gillespie, Colin, Robin Lovelace. 2020. *Efficient R programming*. O’Reilly Media.

Kruchten, Philippe, Robert L Nord, and Ipek Ozkaya. 2012. “Technical Debt: From Metaphor to Theory and Practice.” IEEE Software, no. 6: 18–21.